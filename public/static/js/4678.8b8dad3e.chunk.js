"use strict";(self.webpackChunkabokisub_recovered=self.webpackChunkabokisub_recovered||[]).push([[4678],{14678(e,t,a){a.r(t),a.d(t,{default:()=>Q});var s=a(65043),o=a(19252),n=a(85865),r=a(88911),i=a(12110),c=a(96446),l=a(35721),d=a(98587),u=a(58168),p=a(58387),m=a(98610),A=a(67266),x=a(94340),h=a(34535),g=a(98206),b=a(72949),v=a(27328),y=a(55013),f=a(95849),j=a(51347),C=a(92532),w=a(72372);function S(e){return(0,w.Ay)("MuiListItem",e)}const I=(0,C.A)("MuiListItem",["root","container","focusVisible","dense","alignItemsFlexStart","disabled","divider","gutters","padding","button","secondaryAction","selected"]);var k=a(95434);function N(e){return(0,w.Ay)("MuiListItemSecondaryAction",e)}(0,C.A)("MuiListItemSecondaryAction",["root","disableGutters"]);var R=a(70579);const G=["className"],M=(0,h.Ay)("div",{name:"MuiListItemSecondaryAction",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[t.root,a.disableGutters&&t.disableGutters]}})(e=>{let{ownerState:t}=e;return(0,u.A)({position:"absolute",right:16,top:"50%",transform:"translateY(-50%)"},t.disableGutters&&{right:0})}),_=s.forwardRef(function(e,t){const a=(0,g.b)({props:e,name:"MuiListItemSecondaryAction"}),{className:o}=a,n=(0,d.A)(a,G),r=s.useContext(j.A),i=(0,u.A)({},a,{disableGutters:r.disableGutters}),c=(e=>{const{disableGutters:t,classes:a}=e,s={root:["root",t&&"disableGutters"]};return(0,m.A)(s,N,a)})(i);return(0,R.jsx)(M,(0,u.A)({className:(0,p.A)(c.root,o),ownerState:i,ref:t},n))});_.muiName="ListItemSecondaryAction";const P=_,F=["className"],L=["alignItems","autoFocus","button","children","className","component","components","componentsProps","ContainerComponent","ContainerProps","dense","disabled","disableGutters","disablePadding","divider","focusVisibleClassName","secondaryAction","selected","slotProps","slots"],O=(0,h.Ay)("div",{name:"MuiListItem",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[t.root,a.dense&&t.dense,"flex-start"===a.alignItems&&t.alignItemsFlexStart,a.divider&&t.divider,!a.disableGutters&&t.gutters,!a.disablePadding&&t.padding,a.button&&t.button,a.hasSecondaryAction&&t.secondaryAction]}})(e=>{let{theme:t,ownerState:a}=e;return(0,u.A)({display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",width:"100%",boxSizing:"border-box",textAlign:"left"},!a.disablePadding&&(0,u.A)({paddingTop:8,paddingBottom:8},a.dense&&{paddingTop:4,paddingBottom:4},!a.disableGutters&&{paddingLeft:16,paddingRight:16},!!a.secondaryAction&&{paddingRight:48}),!!a.secondaryAction&&{["& > .".concat(k.A.root)]:{paddingRight:48}},{["&.".concat(I.focusVisible)]:{backgroundColor:(t.vars||t).palette.action.focus},["&.".concat(I.selected)]:{backgroundColor:t.vars?"rgba(".concat(t.vars.palette.primary.mainChannel," / ").concat(t.vars.palette.action.selectedOpacity,")"):(0,A.X4)(t.palette.primary.main,t.palette.action.selectedOpacity),["&.".concat(I.focusVisible)]:{backgroundColor:t.vars?"rgba(".concat(t.vars.palette.primary.mainChannel," / calc(").concat(t.vars.palette.action.selectedOpacity," + ").concat(t.vars.palette.action.focusOpacity,"))"):(0,A.X4)(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},["&.".concat(I.disabled)]:{opacity:(t.vars||t).palette.action.disabledOpacity}},"flex-start"===a.alignItems&&{alignItems:"flex-start"},a.divider&&{borderBottom:"1px solid ".concat((t.vars||t).palette.divider),backgroundClip:"padding-box"},a.button&&{transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},["&.".concat(I.selected,":hover")]:{backgroundColor:t.vars?"rgba(".concat(t.vars.palette.primary.mainChannel," / calc(").concat(t.vars.palette.action.selectedOpacity," + ").concat(t.vars.palette.action.hoverOpacity,"))"):(0,A.X4)(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?"rgba(".concat(t.vars.palette.primary.mainChannel," / ").concat(t.vars.palette.action.selectedOpacity,")"):(0,A.X4)(t.palette.primary.main,t.palette.action.selectedOpacity)}}},a.hasSecondaryAction&&{paddingRight:48})}),z=(0,h.Ay)("li",{name:"MuiListItem",slot:"Container",overridesResolver:(e,t)=>t.container})({position:"relative"}),T=s.forwardRef(function(e,t){const a=(0,g.b)({props:e,name:"MuiListItem"}),{alignItems:o="center",autoFocus:n=!1,button:r=!1,children:i,className:c,component:l,components:A={},componentsProps:h={},ContainerComponent:C="li",ContainerProps:{className:w}={},dense:k=!1,disabled:N=!1,disableGutters:G=!1,disablePadding:M=!1,divider:_=!1,focusVisibleClassName:T,secondaryAction:B,selected:W=!1,slotProps:D={},slots:E={}}=a,V=(0,d.A)(a.ContainerProps,F),X=(0,d.A)(a,L),U=s.useContext(j.A),q=s.useMemo(()=>({dense:k||U.dense||!1,alignItems:o,disableGutters:G}),[o,U.dense,k,G]),H=s.useRef(null);(0,y.A)(()=>{n&&H.current&&H.current.focus()},[n]);const K=s.Children.toArray(i),Y=K.length&&(0,v.A)(K[K.length-1],["ListItemSecondaryAction"]),J=(0,u.A)({},a,{alignItems:o,autoFocus:n,button:r,dense:q.dense,disabled:N,disableGutters:G,disablePadding:M,divider:_,hasSecondaryAction:Y,selected:W}),Q=(e=>{const{alignItems:t,button:a,classes:s,dense:o,disabled:n,disableGutters:r,disablePadding:i,divider:c,hasSecondaryAction:l,selected:d}=e,u={root:["root",o&&"dense",!r&&"gutters",!i&&"padding",c&&"divider",n&&"disabled",a&&"button","flex-start"===t&&"alignItemsFlexStart",l&&"secondaryAction",d&&"selected"],container:["container"]};return(0,m.A)(u,S,s)})(J),Z=(0,f.A)(H,t),$=E.root||A.Root||O,ee=D.root||h.root||{},te=(0,u.A)({className:(0,p.A)(Q.root,ee.className,c),disabled:N},X);let ae=l||"li";return r&&(te.component=l||"div",te.focusVisibleClassName=(0,p.A)(I.focusVisible,T),ae=b.A),Y?(ae=te.component||l?ae:"div","li"===C&&("li"===ae?ae="div":"li"===te.component&&(te.component="div")),(0,R.jsx)(j.A.Provider,{value:q,children:(0,R.jsxs)(z,(0,u.A)({as:C,className:(0,p.A)(Q.container,w),ref:Z,ownerState:J},V,{children:[(0,R.jsx)($,(0,u.A)({},ee,!(0,x.A)($)&&{as:ae,ownerState:(0,u.A)({},J,ee.ownerState)},te,{children:K})),K.pop()]}))})):(0,R.jsx)(j.A.Provider,{value:q,children:(0,R.jsxs)($,(0,u.A)({},ee,{as:ae,ref:Z},!(0,x.A)($)&&{ownerState:(0,u.A)({},J,ee.ownerState)},te,{children:[K,B&&(0,R.jsx)(P,{children:B})]}))})});var B=a(26353),W=a(43845),D=a(39336),E=a(78977),V=a(63336),X=a(17392),U=a(67784),q=a(75678),H=a(74802),K=a(19838),Y=a(26776),J=a(84473);function Q(){const[e,t]=(0,s.useState)([]),[a,d]=(0,s.useState)(null),[u,p]=(0,s.useState)([]),[m,A]=(0,s.useState)(""),[x,h]=(0,s.useState)(!1),[g,b]=(0,s.useState)(null),[v,y]=(0,s.useState)(null),f=(0,s.useRef)(null),j=(window.localStorage.getItem("accessToken"),(0,s.useCallback)(async()=>{try{const e=await J.A.get("/api/admin/support/open-tickets");"success"===e.data.status&&t(e.data.tickets)}catch(e){console.error(e)}},[])),C=(0,s.useCallback)(async e=>{try{const t=await J.A.get("/api/support/chat/".concat(e,"/messages/user"));"success"===t.data.status&&(p(t.data.messages),h("user"===t.data.typing_status))}catch(t){console.error(t)}},[]);(0,s.useEffect)(()=>{j();const e=setInterval(j,1e4);return()=>clearInterval(e)},[j]),(0,s.useEffect)(()=>{if(a){C(a.id);const e=setInterval(()=>C(a.id),5e3);return()=>clearInterval(e)}},[a,C]);const w=async()=>{if(m.trim()||v)try{const e=new FormData;e.append("message",m),v&&e.append("image",v),await J.A.post("/api/admin/support/chat/".concat(a.id,"/reply"),e,{headers:{"Content-Type":"multipart/form-data"}}),A(""),y(null),f.current&&(f.current.value=""),C(a.id)}catch(e){console.error(e)}};return(0,R.jsx)(K.A,{title:"Support Management",children:(0,R.jsxs)(o.A,{maxWidth:"xl",children:[(0,R.jsx)(n.A,{variant:"h4",gutterBottom:!0,children:"Support Center"}),(0,R.jsxs)(r.A,{direction:"row",spacing:3,sx:{height:"75vh"},children:[(0,R.jsxs)(i.A,{sx:{width:400,overflow:"auto"},children:[(0,R.jsx)(c.A,{sx:{p:2,borderBottom:"1px solid #eee"},children:(0,R.jsxs)(n.A,{variant:"subtitle1",children:["Active Sessions (",e.length,")"]})}),(0,R.jsxs)(l.A,{children:[e.map(e=>(0,R.jsxs)("div",{children:[(0,R.jsxs)(T,{button:!0,selected:(null===a||void 0===a?void 0:a.id)===e.id,onClick:()=>d(e),children:[(0,R.jsx)(B.A,{primary:"".concat(e.user_fullname," (@").concat(e.username,")"),secondary:(0,R.jsxs)(r.A,{direction:"row",spacing:1,alignItems:"center",sx:{mt:.5},children:[(0,R.jsx)(W.A,{label:"ai"===e.current_handler?"With Aboki AI":"Human Support",size:"small",variant:"outlined",color:"ai"===e.current_handler?"info":"success",sx:{height:20,fontSize:"0.65rem"}}),(0,R.jsx)(n.A,{variant:"caption",noWrap:!0,sx:{maxWidth:100},children:e.last_message||"New Chat"})]}),primaryTypographyProps:{variant:"subtitle2"}}),(0,R.jsx)(W.A,{label:e.status,size:"small",color:"open"===e.status?"error":"warning",sx:{ml:1}})]}),(0,R.jsx)(D.A,{})]},e.id)),0===e.length&&(0,R.jsx)(c.A,{sx:{p:3,textAlign:"center"},children:(0,R.jsx)(n.A,{variant:"body2",color:"text.secondary",children:"No active support requests"})})]})]}),(0,R.jsx)(i.A,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:a?(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)(c.A,{sx:{p:2,bgcolor:"background.neutral",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #eee"},children:[(0,R.jsxs)(r.A,{direction:"row",spacing:2,alignItems:"center",children:[(0,R.jsxs)(n.A,{variant:"subtitle1",children:["Chat with ",a.user_fullname]}),"ai"===a.current_handler&&(0,R.jsx)(W.A,{label:"User speaking to AI",color:"info",size:"small"})]}),(0,R.jsx)(E.A,{variant:"outlined",color:"error",size:"small",startIcon:(0,R.jsx)(H.A,{}),onClick:()=>(async e=>{try{await J.A.post("/api/admin/support/ticket/".concat(e,"/close")),d(null),j()}catch(t){console.error(t)}})(a.id),children:"Close Session"})]}),(0,R.jsx)(c.A,{sx:{flexGrow:1,p:2,overflow:"auto",bgcolor:"#F9FAFB"},children:(0,R.jsx)(r.A,{spacing:2,children:u.map(e=>{const t="agent"===e.sender_type,a="bot"===e.sender_type,s="user"===e.sender_type;return(0,R.jsx)(c.A,{sx:{display:"flex",justifyContent:s||a?"flex-start":"flex-end"},children:(0,R.jsxs)(V.A,{sx:{p:1.5,maxWidth:"75%",bgcolor:s?"white":a?"#EDF2FF":"#00A86B",color:t?"white":a?"#444":"text.primary",borderRadius:2,border:s?"1px solid #E5E7EB":"none",boxShadow:1},children:[(0,R.jsx)(n.A,{variant:"caption",sx:{fontWeight:"bold",display:"block",mb:.5,opacity:.8},children:s?"User":a?"Aboki AI":"Agent (Me)"}),e.attachment_url&&(0,R.jsx)(c.A,{component:"img",src:e.attachment_url,alt:"attachment",sx:{borderRadius:1,mb:1,maxHeight:200,maxWidth:"100%",display:"block"}}),(0,R.jsx)(n.A,{variant:"body2",children:e.message}),(0,R.jsx)(n.A,{variant:"caption",sx:{opacity:.6,mt:.5,display:"block",textAlign:"right"},children:new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},e.id)})})}),(0,R.jsxs)(c.A,{sx:{p:2,borderTop:"1px solid #eee"},children:[x&&(0,R.jsx)(n.A,{variant:"caption",sx:{ml:1,mb:1,fontStyle:"italic",color:"text.secondary",display:"block"},children:"User is typing..."}),(0,R.jsxs)(r.A,{direction:"row",spacing:2,alignItems:"center",children:[(0,R.jsx)("input",{type:"file",hidden:!0,ref:f,accept:"image/*",onChange:e=>{e.target.files&&e.target.files[0]&&y(e.target.files[0])}}),(0,R.jsx)(X.A,{size:"small",onClick:()=>{var e;return null===(e=f.current)||void 0===e?void 0:e.click()},color:v?"success":"default",children:(0,R.jsx)(Y.A,{icon:"eva:image-outline"})}),(0,R.jsx)(U.A,{fullWidth:!0,size:"small",placeholder:v?"Image selected. Add caption...":"ai"===a.current_handler?"Typing here will take over from AI...":"Type your reply...",value:m,onChange:e=>{const t=e.target.value;if(A(t),!a)return;J.A.post("/api/support/typing",{ticket_id:a.id,status:"start"}),g&&clearTimeout(g);const s=setTimeout(()=>{J.A.post("/api/support/typing",{ticket_id:a.id,status:"stop"})},2e3);b(s)},onKeyPress:e=>{"Enter"===e.key&&w()}}),(0,R.jsx)(X.A,{color:"primary",onClick:w,sx:{bgcolor:"#00A86B",color:"white","&:hover":{bgcolor:"#008f5a"}},children:(0,R.jsx)(q.A,{})})]})]})]}):(0,R.jsxs)(c.A,{sx:{flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[(0,R.jsx)(Y.A,{icon:"eva:message-square-outline",sx:{fontSize:60,color:"text.disabled",mb:2}}),(0,R.jsx)(n.A,{color:"text.secondary",children:"Select an active support session to start"})]})})]})]})})}},74802(e,t,a){var s=a(24994);t.A=void 0;var o=s(a(40039)),n=a(70579);t.A=(0,o.default)((0,n.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close")},75678(e,t,a){var s=a(24994);t.A=void 0;var o=s(a(40039)),n=a(70579);t.A=(0,o.default)((0,n.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send")},12110(e,t,a){a.d(t,{A:()=>g});var s=a(58168),o=a(98587),n=a(65043),r=a(58387),i=a(98610),c=a(34535),l=a(98206),d=a(63336),u=a(92532),p=a(72372);function m(e){return(0,p.Ay)("MuiCard",e)}(0,u.A)("MuiCard",["root"]);var A=a(70579);const x=["className","raised"],h=(0,c.Ay)(d.A,{name:"MuiCard",slot:"Root",overridesResolver:(e,t)=>t.root})(()=>({overflow:"hidden"})),g=n.forwardRef(function(e,t){const a=(0,l.b)({props:e,name:"MuiCard"}),{className:n,raised:c=!1}=a,d=(0,o.A)(a,x),u=(0,s.A)({},a,{raised:c}),p=(e=>{const{classes:t}=e;return(0,i.A)({root:["root"]},m,t)})(u);return(0,A.jsx)(h,(0,s.A)({className:(0,r.A)(p.root,n),elevation:c?8:void 0,ref:t,ownerState:u},d))})}}]);
//# sourceMappingURL=4678.8b8dad3e.chunk.js.map