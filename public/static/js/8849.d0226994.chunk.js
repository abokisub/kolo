"use strict";(self.webpackChunkabokisub_recovered=self.webpackChunkabokisub_recovered||[]).push([[8849],{28849(e,t,a){a.r(t),a.d(t,{default:()=>y});var s=a(65043),r=a(19252),o=a(85865),i=a(12110),n=a(96446),c=a(88911),l=a(81045),d=a(43845),u=a(63336),p=a(81637),x=a(67784),h=a(17392),m=a(19838),A=a(26776),g=a(84473),f=a(70579);function y(){const[e,t]=(0,s.useState)([]),[a,y]=(0,s.useState)(""),[b,v]=(0,s.useState)(!1),[j,w]=(0,s.useState)("ai"),[k,S]=(0,s.useState)(null),C=(0,s.useRef)(null),_=(0,s.useCallback)(async e=>{try{const a=await g.A.get("/api/support/chat/".concat(e,"/messages/user"));"success"===a.data.status&&(t(a.data.messages),w(a.data.current_handler))}catch(a){console.error("Fetch messages error:",a)}},[]),I=(0,s.useCallback)(async()=>{try{const e=await g.A.get("/api/support/tickets");if("success"===e.data.status){const t=e.data.tickets.find(e=>"closed"!==e.status);t&&(S(t.id),_(t.id))}}catch(e){console.error("Fetch tickets error:",e)}},[_]);(0,s.useEffect)(()=>{I()},[I]),(0,s.useEffect)(()=>{let e;return k&&"agent"===j&&(e=setInterval(()=>_(k),5e3)),()=>clearInterval(e)},[k,j,_]),(0,s.useEffect)(()=>{C.current&&(C.current.scrollTop=C.current.scrollHeight)},[e]);const D=async()=>{if(!a.trim())return;const e={message:a,sender_type:"user",created_at:(new Date).toISOString()};t(t=>[...t,e]);const s=a;y(""),v(!0);try{if("agent"===j)await g.A.post("/api/support/chat/".concat(k,"/send/user"),{message:s});else{const e=await g.A.post("/api/chat/aboki",{message:s});"success"===e.data.status&&(S(e.data.conversation_id),e.data.message&&t(t=>[...t,{message:e.data.message,sender_type:"bot",created_at:(new Date).toISOString()}]),"agent"===e.data.handler&&w("agent"))}}catch(r){console.error("Send message error:",r)}finally{v(!1)}};return(0,f.jsx)(m.A,{title:"Support Chat",children:(0,f.jsxs)(r.A,{maxWidth:"md",children:[(0,f.jsx)(o.A,{variant:"h4",sx:{mb:3},children:"Customer Support"}),(0,f.jsxs)(i.A,{sx:{height:"70vh",display:"flex",flexDirection:"column"},children:[(0,f.jsxs)(n.A,{sx:{p:2,borderBottom:"1px solid #eee",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,f.jsxs)(c.A,{direction:"row",spacing:2,alignItems:"center",children:[(0,f.jsx)(l.A,{sx:{bgcolor:"ai"===j?"primary.main":"success.main"},children:(0,f.jsx)(A.A,{icon:"ai"===j?"eva:robot-outline":"eva:person-outline"})}),(0,f.jsxs)(n.A,{children:[(0,f.jsx)(o.A,{variant:"subtitle1",children:"ai"===j?"Aboki AI":"Live Support Agent"}),(0,f.jsx)(o.A,{variant:"caption",color:"text.secondary",children:"ai"===j?"Automated Assistant":"Connected to Support Team"})]})]}),"ai"===j&&(0,f.jsx)(d.A,{label:"24/7 Support",color:"primary",variant:"outlined",size:"small"})]}),(0,f.jsxs)(n.A,{ref:C,sx:{flexGrow:1,p:3,overflow:"auto",bgcolor:"#F4F6F8",display:"flex",flexDirection:"column",gap:2},children:[0===e.length&&(0,f.jsxs)(n.A,{sx:{textAlign:"center",mt:5},children:[(0,f.jsx)(o.A,{variant:"body1",color:"text.secondary",children:"Hi! \ud83d\udc4b I'm Aboki. How can I help you today?"}),(0,f.jsx)(o.A,{variant:"caption",color:"text.disabled",children:"You can ask about transactions, KYC, or talk to an agent."})]}),e.map((e,t)=>{const a="user"===e.sender_type;e.sender_type;return(0,f.jsx)(n.A,{sx:{alignSelf:a?"flex-end":"flex-start",maxWidth:"80%"},children:(0,f.jsxs)(u.A,{sx:{p:2,bgcolor:a?"primary.main":"white",color:a?"white":"text.primary",borderRadius:2,boxShadow:1},children:[(0,f.jsx)(o.A,{variant:"body2",children:e.message}),(0,f.jsx)(o.A,{variant:"caption",sx:{display:"block",mt:.5,opacity:.7,textAlign:"right"},children:new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},t)}),b&&"ai"===j&&(0,f.jsx)(n.A,{sx:{alignSelf:"flex-start"},children:(0,f.jsx)(p.A,{size:20,thickness:5})})]}),(0,f.jsx)(n.A,{sx:{p:2,borderTop:"1px solid #eee"},children:(0,f.jsxs)(c.A,{direction:"row",spacing:2,children:[(0,f.jsx)(x.A,{fullWidth:!0,placeholder:"Type your message...",value:a,onChange:e=>y(e.target.value),onKeyPress:e=>{"Enter"===e.key&&D()},disabled:b&&"ai"===j}),(0,f.jsx)(h.A,{color:"primary",onClick:D,disabled:!a.trim()||b&&"ai"===j,sx:{bgcolor:"primary.main",color:"white","&:hover":{bgcolor:"primary.dark"}},children:(0,f.jsx)(A.A,{icon:"eva:paper-plane-fill"})})]})})]})]})})}},12110(e,t,a){a.d(t,{A:()=>g});var s=a(58168),r=a(98587),o=a(65043),i=a(58387),n=a(98610),c=a(34535),l=a(98206),d=a(63336),u=a(92532),p=a(72372);function x(e){return(0,p.Ay)("MuiCard",e)}(0,u.A)("MuiCard",["root"]);var h=a(70579);const m=["className","raised"],A=(0,c.Ay)(d.A,{name:"MuiCard",slot:"Root",overridesResolver:(e,t)=>t.root})(()=>({overflow:"hidden"})),g=o.forwardRef(function(e,t){const a=(0,l.b)({props:e,name:"MuiCard"}),{className:o,raised:c=!1}=a,d=(0,r.A)(a,m),u=(0,s.A)({},a,{raised:c}),p=(e=>{const{classes:t}=e;return(0,n.A)({root:["root"]},x,t)})(u);return(0,h.jsx)(A,(0,s.A)({className:(0,i.A)(p.root,o),elevation:c?8:void 0,ref:t,ownerState:u},d))})}}]);
//# sourceMappingURL=8849.d0226994.chunk.js.map